<h3>Entity Based Feedbacks</h3>

<!-- <table mat-table [dataSource]="dataSource" class="mat-elevation-z2 feedback-table">
    <ng-container matColumnDef="user_name">
        <th mat-header-cell *matHeaderCellDef>
            <b>Customer Name</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.user_name}}
        </td>
    </ng-container>
    <ng-container matColumnDef="product_id">
        <th mat-header-cell *matHeaderCellDef>
            <b>Product ID</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.product_id}}
        </td>
    </ng-container>
    <ng-container matColumnDef="feedback_id">
        <th mat-header-cell *matHeaderCellDef>
            <b>Feedback ID</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.feedback_id}}
        </td>
    </ng-container>
    <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef>
            <b>User Rating</b>
        </th>
        <td mat-cell *matCellDef="let element">
            <img src="../../../assets/star.svg" alt="star">
            {{element.rating}}
        </td>
    </ng-container>
    <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef>
            <b>Posted On</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.created_at | date}}
        </td>
    </ng-container>
    <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>
            <b>Actions</b>
        </th>
        <td mat-cell *matCellDef="let element">
            <button mat-icon-button color="primary" matTooltip="Details" routerLink="feedback/{{element.feedback_id}}">
                <img src="../../../assets/eye.svg" alt="details">
            </button>
            <button mat-icon-button color="warn" (click)="openFeedbackDetailDialogue(
                element.feedback_id,
                element.created_at
            )" matTooltip="Reply">
                <img src="../../../assets/reply.svg" alt="reply">
            </button>
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayFeedbackColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayFeedbackColumns;"></tr>
</table>

<mat-paginator [length]="totalData" [pageSize]="pageSize" (page)="handlePageEvent($event)" #paginator>
</mat-paginator> -->

<!-- <h3>Test</h3>

<table mat-table [dataSource]="dataSource" class="feedback-table mat-elevation-z2" multiTemplateDataRows>
    <ng-container matColumnDef="serial">
        <th mat-header-cell *matHeaderCellDef>
            <b>S.No.</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.serial}}
        </td>
    </ng-container>
    <ng-container matColumnDef="productId">
        <th mat-header-cell *matHeaderCellDef>
            <b>Ref. ID</b>
        </th>
        <td mat-cell *matCellDef="let element">
            <div class="display-cell">
                {{element.productId}}
            <img src="../../../assets/down-arrow.svg" alt="expand" class="grid-control" *ngIf="element.numberOfFeedbacks && !element.isExpanded" (click)="element.isExpanded=!element.isExpanded">
            <img src="../../../assets/up-arrow.svg" alt="collapse" class="grid-control" *ngIf="element.numberOfFeedbacks && element.isExpanded" (click)="element.isExpanded=!element.isExpanded">
            </div>
        </td>
    </ng-container>
    <ng-container matColumnDef="productName">
        <th mat-header-cell *matHeaderCellDef>
            <b>Name</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.productName}}
        </td>
    </ng-container>
    <ng-container matColumnDef="productCategory">
        <th mat-header-cell *matHeaderCellDef>
            <b>Category</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.productCategory}}
        </td>
    </ng-container>
    <ng-container matColumnDef="numberOfFeedbacks">
        <th mat-header-cell *matHeaderCellDef>
            <b>No. of feedbacks</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.numberOfFeedbacks}}
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="ColumnsToDisplay"></tr>
    <tr mat-row *matRowDef="let row; columns: ColumnsToDisplay;"></tr>
</table> -->





<table mat-table [dataSource]="dataSource" class="feedback-table mat-elevation-z2" multiTemplateDataRows>
    <ng-container matColumnDef="serial">
        <th mat-header-cell *matHeaderCellDef>
            <b>S.No.</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.serial}}
        </td>
    </ng-container>
    <ng-container matColumnDef="productId">
        <th mat-header-cell *matHeaderCellDef>
            <b>Ref. ID</b>
        </th>
        <td mat-cell *matCellDef="let element">
            <div class="display-cell">
                {{element.productId}}
            <img src="../../../assets/down-arrow.svg" alt="expand" class="grid-control" *ngIf="element.numberOfFeedbacks && !element.isExpanded" (click)="element.isExpanded=!element.isExpanded">
            <img src="../../../assets/up-arrow.svg" alt="collapse" class="grid-control" *ngIf="element.numberOfFeedbacks && element.isExpanded" (click)="element.isExpanded=!element.isExpanded">
            </div>
        </td>
    </ng-container>
    <ng-container matColumnDef="productName">
        <th mat-header-cell *matHeaderCellDef>
            <b>Name</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.productName}}
        </td>
    </ng-container>
    <ng-container matColumnDef="productCategory">
        <th mat-header-cell *matHeaderCellDef>
            <b>Category</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.productCategory}}
        </td>
    </ng-container>
    <ng-container matColumnDef="numberOfFeedbacks">
        <th mat-header-cell *matHeaderCellDef>
            <b>No. of feedbacks</b>
        </th>
        <td mat-cell *matCellDef="let element">
            {{element.numberOfFeedbacks}}
        </td>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
		<td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
			<div class="example-element-detail" *ngIf="element.details?.data?.length" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                <!-- <div class="example-element-detail" *ngIf="element.details?.length" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'"> -->
				<div class="inner-table" *ngIf="expandedElement">
          <!-- <mat-form-field>
            <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
          </mat-form-field> -->
          <table #innerTables mat-table #innerSort="matSort" [dataSource]="element.details" matSort>
            <ng-container matColumnDef="{{innerColumn}}" *ngFor="let innerColumn of innerDisplayedColumns">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> {{innerColumn}} </th>
              <td mat-cell *matCellDef="let element"> {{element[innerColumn]}} </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="innerDisplayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: innerDisplayedColumns;"></tr>
          </table>
				</div>
			</div>
		</td>
	</ng-container>

    <!-- <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
    <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr> -->
    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" (click)="toggleRow(element)">
	</tr>
	<tr mat-row *matRowDef="let row; columns: ['expandedDetail']"></tr>
</table>